\documentclass[../thesis.tex]{subfiles}

\begin{document}

\chapter{Fitting}
\label{chap:fitting}

\section{Overview}
\label{sec:fitoverview}

In order to extract neutrino oscillation parameters, Daya Bay data is compared to the predictions associated with different parameter values, and the extracted parameters are then those that give the best fit to the data. Given knowledge of the reactor flux, detector response, and expected backgrounds, it is conceptually straightforward to generate a set of predictions. However, incorporating systematic and statistical uncertainties, and then assigning error bars to the extracted parameters, is where the procedure becomes more subtle and complex. In Daya Bay, separate analysis groups have historically employed two different approaches, theoretically equivalent but implemented very differently. These are the method of pull terms, and the covariance matrix approach. In this analysis, we use the latter, but both will be briefly described in what follows.

\subsection{Method of pull terms}
\label{sec:pullterms}

In the method of pull terms, the fitter is ``smart'' in the sense that it has knowledge of the underlying models (reactor, detector, background, etc.) and knows how their predictions will vary under different assumptions regarding systematic uncertainties. In this approach, each systematic is parameterized by a \emph{pull term} (or \emph{nuissance parameter}), which is in turn given an uncertainty of its own. An example of such a pull term might be the relative energy response of a given AD. Each pull term is assigned a nominal value, corresponding to our best estimate given available knowledge. Then, during the fit, not only are the oscillation parameters varied, but so are the pull terms, and the predictions transform accordingly. The total $\chi^2$ then takes a form similar to
\[ \chi^2 = \sum_i \frac{(x_i - \overline x_i)^2}{\sigma_i^2}
  + \sum_j \frac{(\eta_j - \overline \eta_j)^2}{\varsigma_j^2}, \]
where $x_i$ are the measured data (e.g., AD spectra), $\overline x_i$ are the predictions (which vary as we scan the oscillation parameters and pull terms), $\sigma_i$ are the \emph{statistical} uncertainties on the data, $\eta_j$ are the pull terms, $\overline \eta_j$ are their nominal values, and $\varsigma_j$ are the uncertainties on the pulls.

Fitting is complete when the fitter has found the values of the oscillation parameters \emph{and pull terms} that minimize the total $\chi^2$. The 1$\sigma$ error bars on the oscillation parameters are then based on the amount of variation required to increase the reduced $\chi^2$ by one unit (minimizing over the pull terms at every step). Correlations between spectral energy bins are handled implicitly; the information is encoded in the manner in which different bins move together when pull terms are varied.

\subsection{Covariance matrix approach}
\label{sec:covmatapproach}

As an alternative to using pull terms, uncertainties and correlations can be encoded in a single covariance matrix generated using Monte Carlo techniques. In this approach, the fitter is relatively ``dumb'': It knows only how to generate a prediction using a \emph{nominal} model (of, again, reactors, backgrounds, detectors, etc.) and how to vary the prediction for different values of the oscillation parameters. It has no idea how the prediction will vary under changing systematics. (This knowedge belongs to the Monte Carlo.) The fitter's job is simply to take the measurements $x_i$, the predictions $\overline x_i$ (which vary according to the oscillation parameters), and the covariance matrix $V_{ij}$, and then to find the oscillation parameters which minimize the $\chi^2$,
\[ \chi^2 = (x_i - \overline x_i) V_{ij}^{-1} (x_j - \overline x_j). \]

In practice, the full NuWa-based Monte Carlo is not used for generating the covariance matrix, due to its complexity and computational cost. Instead, a ``toy'' MC, described in the next section, was developed for this purpose. 

\section{Toy Monte Carlo}
\label{sec:toymc}

\section{Preparation of nominal reactor spectra}
\label{sec:nomspecprep}

An important input to both the fitter and the toy MC is the nominal prediction of the spectrum from each of the six reactors. To produce this prediction, a number of basic inputs are required:

\begin{itemize}
\item Weekly average thermal power and fission fractions for each reactor, as reported by the Reactor Working Group using data provided by the power company. The fission fractions are determined from simulations, as described in Chapter XXX.
\item Weekly detector livetimes, in order to properly weight the spectra for each week. Given that we only use data where all three halls were operating (and passing data quality requirements) simultaneously, there is only a single value for each week, not three values.
\item Nominal fission spectra, in 10~keV increments of true neutrino energy from 1.8 to 13~MeV, and in units of
  $\overline\nu_e$~MeV$^{-1}$~fission$^{-1}$. For $^{235}$U, $^{239}$Pu, and $^{241}$Pu, Huber's spectra are used, whereas the French spectrum is used for $^{238}$U.
\end{itemize}

\end{document}